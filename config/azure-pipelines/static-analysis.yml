parameters:
  displayName: ''
  os: ''
  vmImage: ''
jobs:
  - job: static_analysis_${{ parameters.os }}
    displayName: ${{ parameters.displayName }}
    pool:
      vmImage: ${{ parameters.vmImage }}
    variables:
      - name: reportsDirectory
        value: static-analysis/${{ parameters.os }}
    steps:
      - task: NodeTool@0
        displayName: Install Node
        inputs:
          versionSpec: $(nodeVersion)
      - script: npm install
        displayName: Install Node dependencies
      - script: |
          npx prettylint --ignore-path .gitignore **/*.{json,md,yml}
          npm run --silent lint-scripts -- --format junit --output-file $(reportsDirectory)/lint-scripts.xml
        displayName: Run static analysis
      - publish: $(reportsDirectory)
        displayName: Publish reports artifact
        artifact: static-analysis-${{ parameters.os }}
      - task: PublishTestResults@2
        displayName: Publish tests results
        condition: succeededOrFailed()
        inputs:
          testResultsFiles: '**/*.xml'
          searchFolder: $(System.DefaultWorkingDirectory)/$(reportsDirectory)
